var __reflect=this&&this.__reflect||function(e,t,o){e.__class__=t,o?o.push(t):o=[t],e.__types__=e.__types__?o.concat(e.__types__):o},__extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);o.prototype=t.prototype,e.prototype=new o},api;!function(e){var t=function(){function e(){this.$coins=0}return e.prototype.setUserName=function(e){this.$userName=e},e.prototype.getUserName=function(){return this.$userName},e.prototype.setUserCoins=function(e){this.$coins=e},e.prototype.getUserCoins=function(){return this.$coins},e.prototype.setUserIcon=function(e){this.$icon=e},e.prototype.getUserIcon=function(){return this.$icon},e.prototype.getOpenId=function(){return this.$openId},e.prototype.setOpenId=function(e){this.$openId=e},e}();e.UserData=t,__reflect(t.prototype,"api.UserData",["api.IUserData"])}(api||(api={}));var AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,o){function n(n){t.call(o,n,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?n(s):RES.getResAsync(e,n,this)}else RES.getResByUrl(e,n,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){})},t}(eui.UILayer);__reflect(Main.prototype,"Main");var CallBackVo=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null);for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];this.once=!1,this.handeler=e,this.thisObj=t,this.arg=o}return e.prototype.apply=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e&&e.length>0&&(this.arg=e),this.handeler.apply(this.thisObj,this.arg)},e.prototype.free=function(){this.handeler=null,this.thisObj=null,this.arg=null,this.once=null},e}();__reflect(CallBackVo.prototype,"CallBackVo");var CEvent=function(e){function t(t,o,n,s){void 0===o&&(o=null),void 0===n&&(n=!1),void 0===s&&(s=!1);var i=e.call(this,t,n,s)||this;return i._data=o,i}return __extends(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),t}(egret.Event);__reflect(CEvent.prototype,"CEvent");var api;!function(e){function t(e,t,n,s){void 0===t&&(t=1),void 0===n&&(n=null),void 0===s&&(s=null);for(var i=[],r=4;r<arguments.length;r++)i[r-4]=arguments[r];var a=new(o.bind.apply(o,[void 0,e,t,n,s].concat(i)));return gui.addBox(a),a}var o=function(e){function t(t,o,s,i){void 0===o&&(o=1),void 0===s&&(s=null),void 0===i&&(i=null);for(var r=[],a=4;a<arguments.length;a++)r[a-4]=arguments[a];var l=e.call(this,"common","alerView")||this;return l._message=t,l._button=o,null!=s&&(l._callback=gameTool.poolList.getInstance(n),l._callback.sleep=!1,l._callback.fun=s,l._callback.context=i,l._callback.args=r),l.txt&&(l.txt.text=l._message),l}return __extends(t,e),t.prototype.initView=function(){this.txt=this.getTextField("txt"),this.select=this._ui.getController("select"),this._button==t.OK?this.select.selectedPage="1":this.select.selectedPage="2",this.txt.text=this._message},t.prototype.onClick=function(e){switch(e.currentTarget.name){case"closeButton":case"cannel":null!=this._callback&&(this._callback.args=[t.CANCEL].concat(this._callback.args),this._callback.call()),this.dispose();break;case"ok1":case"ok0":null!=this._callback&&(this._callback.args=[t.OK].concat(this._callback.args),this._callback.call()),this.dispose()}},t.prototype.dispose=function(){null!=this._callback&&(gameTool.poolList.remove(this._callback),this._callback=null),e.prototype.dispose.call(this)},t.OK=1,t.CANCEL=2,t.OK_CANCEL=3,t}(gui.OvBase);e.Alert=o,__reflect(o.prototype,"api.Alert");var n=function(){function e(){}return e.prototype.dispose=function(){this.fun=null,this.context=null,this.args=null},e.prototype.call=function(){this.sleep||("string"==typeof this.fun?this.context[this.fun]=this.args?this.args[0]:null:this.fun.apply(this.context,this.args))},e.prototype.onceCall=function(){this.call(),gameTool.poolList.remove(this),this.dispose()},e}();e.FunctionInfo=n,__reflect(n.prototype,"api.FunctionInfo"),e.createAlert=t}(api||(api={}));var api;!function(e){var t=function(){function t(){}return t.initView=function(t){this.localData=new e.LocalData,this.webSocket=new e.Network,this.userData=new e.UserData,this.moduleManager=new ModuleManager,this.soundManager=new SoundManagers(t)},t}();e.GlobalAPI=t,__reflect(t.prototype,"api.GlobalAPI")}(api||(api={}));var api;!function(e){var t=function(){function e(){}return e.prototype.get=function(e){return egret.localStorage.getItem(e)},e.prototype.set=function(e,t){egret.localStorage.setItem(e,t)},e.prototype.remove=function(e){egret.localStorage.removeItem(e)},e}();e.LocalData=t,__reflect(t.prototype,"api.LocalData",["api.ILocalData"])}(api||(api={}));var api;!function(e){var t=function(){function e(){}return e.prototype.Request=function(){},e}();__reflect(t.prototype,"Request");var o;!function(e){e[e.None=0]="None",e[e.Response=1]="Response",e[e.Request=2]="Request",e[e.Notify=3]="Notify"}(o||(o={}));var n=function(){function n(){this.callbacks={},this.requests={},this.losts=[],this.showMessage=!0,this.reconnect=-1,this.timer=null,this.handledMsg=[],this.requestid=egret.getTimer()%2e4}return n.prototype.login=function(t){var o=t;e.GlobalAPI.webSocket.request(GameEvent.Login,{open_id:o},function(e){"登陆成功"==e.msg||"游戏已结束"==e.msg?gui.addScene(DoorView):"游戏未开始"==e.msg||"游戏界面"==e.msg},function(e,t,o){console.error("无法连接游戏服务器,请确认网络连接无异常.[code:%s,msg:%s]",t,o)})},n.prototype.connectServer=function(e,t,o){var n=e.substr(0,e.indexOf(":")),s=parseInt(e.substr(e.indexOf(":")+1,e.length));this.loginCallback=t,this.connect(n,s)&&(t&&t(o),this.loginCallback=null),null!=this.timer&&(this.timer=egret.setInterval(this.timeCheck,this,1e3))},n.prototype.notify=function(e,t){e=e.toLocaleLowerCase();var n={messageType:o.Notify,event:e,sequence:0};if(this.host||!this.port)return this.webSocket&&this.webSocket.connected?void this.write(n,t):(this.losts.push({head:n,param:t}),void this.connect(this.host,this.port))},n.prototype.request=function(e,n,s,i){e=e.toLocaleLowerCase();var r=new t;r.id=this.requestid++,r.event=e,r.param=n||{},r.callback=s,r.errcb=i,this.requests[r.id]=r,this.requestid>=3e4&&(this.requestid=1);var a={messageType:o.Request,event:e,sequence:r.id};return this.webSocket&&this.webSocket.connected?(this.write(a,n),void(r.sendTime=egret.getTimer()/1e3)):(this.losts.push({head:a,param:n}),void this.connect(this.host,this.port))},n.prototype.on=function(e,t,o){e=e.toLocaleLowerCase();var n=this.callbacks[e]||(this.callbacks[e]=[]);o&&(t.errcb=o),-1==n.indexOf(t)&&n.push(t)},n.prototype.off=function(e,t){e=e.toLocaleLowerCase();var o=this.callbacks[e];if(o){if(!t)return void(this.callbacks[e]=[]);for(var n=o.length-1;n>=0;n--)o[n]===t&&o.splice(n,1)}},n.prototype.connected=function(e,t){return this.webSocket&&this.webSocket.connected},n.prototype.requestLost=function(){var e=this;this.losts.forEach(function(t){e.write(t.head,t.param)}),this.losts=[]},n.prototype.close=function(){this.webSocket&&this.webSocket.close()},n.prototype.connect=function(t,o){if(this.webSocket&&this.webSocket.connected&&this.host==t&&this.port==o)return!0;"ON"==e.GlobalAPI.localData.get("ShowDebugMessage")&&(this.showMessage=!0),this.host=t,this.port=o,this.webSocket||(this.webSocket=new egret.WebSocket,this.webSocket.type=egret.WebSocket.TYPE_BINARY,this.webSocket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.webSocket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.webSocket.addEventListener(egret.Event.CLOSE,this.onClosed,this),this.webSocket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onError,this));try{this.webSocket.close();var n=t.split("."),s=!1;for(var i in n)if(!Number(n[i])){s=!0;break}s?egret.setTimeout(this.webSocket.connectByUrl,this.webSocket,0,"wss://"+t):egret.setTimeout(this.webSocket.connect,this.webSocket,0,t,o)}catch(r){this.onError(r)}},n.prototype.onReceiveMessage=function(){var e=new egret.ByteArray;this.webSocket.readBytes(e);var t={messageType:0,srcType:0,srcId:0,descType:0,descId:0,event:"",sequence:0,errcode:0};t.messageType=e.readByte(),t.srcType=e.readByte(),t.srcId=(e.readInt()<<32)+e.readInt(),t.descType=e.readByte(),t.descId=(e.readInt()<<32)+e.readInt(),t.event=e.readUTF().toLocaleLowerCase(),t.sequence=e.readShort(),t.errcode=e.readShort();var n=t.event+"@"+t.sequence;if(!(t.messageType==o.Response&&this.handledMsg.indexOf(n)>-1)){var s=0!=t.errcode?e.readUTF:JSON.parse(e.readUTF()),i=this.callbacks[t.event];if(i)for(var r=0;r<i.length;r++){var a=i[r];if(a)if(t.errcode){var l=a.errcb||this.defaultErrCb;l(t.event,t.errcode,s)}else a(s)}var u=null;if(0!=t.sequence&&(u=this.requests[t.sequence]))if(delete this.requests[t.sequence],t.errcode){var c=u.errcb||this.defaultErrCb;c(t.event,t.errcode,s)}else u.callback&&u.callback(s);i||u||console.error("未监听服务端[%s]消息",t.event),t.messageType==o.Response&&(this.handledMsg.unshift(n),this.handledMsg.length>30&&this.handledMsg.pop())}},n.prototype.timeCheck=function(){var e=egret.getTimer()/1e3;for(var t in this.requests){var n=this.requests[t];if(n.sendTime<e-15e3){n.sendTime=e;var s={messageType:o.Request,event:n.event,sequence:n.id};if(!this.webSocket||this.webSocket.connected)return this.losts.push({head:s,param:n.param}),void this.connect(this.host,this.port);console.log("消息重发：%s, %s",n.event,n.id),this.write(s,n.param)}}},n.prototype.write=function(e,t){var o=new egret.ByteArray;o.writeByte(e.messageType),o.writeShort(e.sequence),o.writeUTF(e.event),o.writeUTF(JSON.stringify(t)),o.position=0,this.webSocket.writeBytes(o,0,o.bytesAvailable)},n.prototype.onSocketOpen=function(){this.loginCallback?(this.loginCallback(this.loginparam),this.loginCallback=null):this.login(this.loginparam)},n.prototype.onClosed=function(){this.webSocket.close()},n.prototype.onError=function(t){var o=this;-1==this.reconnect&&(e.createAlert("网络连接失败3秒后重试",1),this.reconnect=egret.setTimeout(function(){o.connect(o.host,o.port),o.reconnect=-1},this,3e3))},n.prototype.defaultErrCb=function(e,t,o){console.log("消息[%s]处理失败, 错误码:%s, 附加消息:%s",e,t,o)},n}();e.Network=n,__reflect(n.prototype,"api.Network",["api.INetWork"])}(api||(api={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var SoundManagers=function(){function e(e){this.volume=.2,this.effvolume=.2,this._lastMusic="resource/sounds/bgmusic.mp3",this._soundFlag=!1,this._musicFlag=!1,this.isInPlay=!1,this.allChannel=[],this.isComplete=[!1,!1],e.addEventListener(egret.Event.DEACTIVATE,this.onBlur,this),e.addEventListener(egret.Event.ACTIVATE,this.onFocus,this)}return e.prototype.changeSound=function(e){this._soundFlag!=e&&(this._soundFlag=e)},e.prototype.playEffect=function(e,t){this._soundFlag&&RES.getResAsync(e,function(){var o=RES.getRes(e);o.type=egret.Sound.EFFECT;var n=o.play(0,1);n.volume=t?t:this.effvolume},this)},e.prototype.playEffectBuYrl=function(e,t,o){var n=this;if(this._soundFlag){var s=new egret.Sound;return s.load(e),s.addEventListener(egret.Event.COMPLETE,function(){var e=s.play(0,t?t:0);e.volume=o?o:n.effvolume,s.channel=e},this),s}},e.prototype.changeMusic=function(e){this._musicFlag!=e&&(this._musicFlag=e,this._musicFlag?this.isInPlay?this.playRedBGM(!0):this.playBGM("resource/sounds/bgmusic.mp3"):this.pauseBGM())},e.prototype.playRedBGM=function(e){void 0===e&&(e=!1),this.playBGM("resource/sounds/bgmusic.mp3"),this.isInPlay=!0},e.prototype.playBGM=function(e,t){var o=this;if(void 0===t&&(t=!1),t||(this.preBGM=this._lastMusic),this._lastMusic=e,this._musicFlag){if(this.isPause&&this.pauseMusic==e)return void this.resumeBGM();this.disposeSound(),RES.getResByUrl(this._lastMusic,function(e){o._sound=e,o._sound.type=egret.Sound.MUSIC,o._soundChannel&&o._soundChannel.stop(),o._soundChannel=o._sound.play(0,-1),o._soundChannel.volume=.2*o.volume},this,"sound")}},e.prototype.pauseBGM=function(){this._soundChannel&&!this._soundChannel.isStopped&&(this._soundChannel.volume=0,this.pauseMusic=this._lastMusic,this.isPause=!0)},e.prototype.resumeBGM=function(){this._musicFlag&&this._soundChannel&&!this._soundChannel.isStopped&&(this._soundChannel.volume=.2*this.volume,this.isPause=!1)},e.prototype.onBlur=function(){this.pauseBGM()},e.prototype.onFocus=function(){this.resumeBGM()},e.prototype.playPreBGM=function(){this.playBGM(this.preBGM),this.isInPlay=!1},e.prototype.resetBGM=function(){this.playBGM("resource/sounds/bgmusic.mp3"),this.isInPlay=!1},e.prototype.soundLoaded=function(){this._musicFlag&&(this._sound=RES.getRes(this._lastMusic),this._sound.type=egret.Sound.MUSIC,this._soundChannel=this._sound.play(0,-1),this._soundChannel.volume=this.volume)},e.prototype.disposeSound=function(){this._soundChannel&&(this._soundChannel.stop(),this._soundChannel=null),this._sound&&this._sound.removeEventListener(egret.Event.COMPLETE,this.soundLoaded,this)},e.prototype.soundInit=function(){var e=this;if(null==this.allSound){this.allSound=[];for(var t=["resource/sounds/shootApp_1.mp3","resource/sounds/shootApp_2.mp3","resource/sounds/shootApp_3.mp3","resource/sounds/shootBla_1.mp3","resource/sounds/shootBla_2.mp3","resource/sounds/shootBla_3.mp3","resource/sounds/shoot_1.mp3","resource/sounds/shoot_2.mp3","resource/sounds/shoot_3.mp3","resource/sounds/shoot_4.mp3","resource/sounds/ps_1.mp3","resource/sounds/ps_2.wav","resource/sounds/ps_3.mp3","resource/sounds/ps_4.mp3"],o=0;o<t.length;o++)this.isComplete[o]=!1,this.allSound.push(new egret.Sound),this.allSound[o].load(t[o]),this.allSound[o].addEventListener(egret.Event.COMPLETE,function(n){e.isComplete[e.allSound.indexOf(n.currentTarget)]=!0,e.allReadly()&&o>=t.length&&notification.postNotification("ready")},this)}},e.prototype.cleanChannel=function(e){this.allChannel[e]&&(this.allChannel[e].stop(),this.allChannel[e]=null)},e.prototype.createChannel=function(e,t,o,n){void 0===o&&(o=0),void 0===n&&(n=1),this.isComplete[e]&&(this.cleanChannel(e),api.GlobalAPI.soundManager._soundFlag&&(this.allChannel[e]=this.allSound[e].play(o,n),this.allChannel[e].volume=t,this.allSound[e].channel=this.allChannel[e]))},e.prototype.disposeAllSound=function(){if(null!=this.allSound){for(var e=0;e<this.allSound.length;e++)this.allChannel[e]&&(this.allChannel[e].stop(),this.allChannel[e]=null),this.allSound[e]&&(this.allSound[e]=null),this.isComplete[e]=!1;this.allSound=null}},e.prototype.allReadly=function(){for(var e=0;e<this.isComplete.length;e++)if(!this.isComplete[e])return!1;return!0},e}();__reflect(SoundManagers.prototype,"SoundManagers");var base;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.isCache=!0,t.isApplying=!1,t}return __extends(t,e),t.prototype.enter=function(e){for(var t=this,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];this._moduleInfo=e,loadUtil.loadConfigItems(mathTool.pluck(this.getConfigs(),"path"),function(){e.coreClass.data=new e.dataClass,t.open.apply(t,o),t.initData.apply(t,o)},this,mathTool.pluck(this.getConfigs(),"parse"),this)},t.prototype.initData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.isApplying=!0},t.prototype.close=function(){this.isApplying=!1,this._moduleInfo.coreClass.data.dispose(),this._moduleInfo.coreClass.dispose(),this._groups=null},t.prototype.getConfigs=function(){return[]},t.prototype.loadGroup=function(e,t,o,n){void 0===t&&(t=0);for(var s=[],i=4;i<arguments.length;i++)s[i-4]=arguments[i];loadUtil.loadGroup.apply(loadUtil,[e,null,o,n].concat(s)),mathTool.addValueByArray(e,this._groups)},t.prototype.destroyCache=function(){},Object.defineProperty(t.prototype,"moduleName",{get:function(){return this._moduleName},set:function(e){this._moduleName=e,this._packageName="module_"+this._moduleName,this._groups=[e]},enumerable:!0,configurable:!0}),t}(egret.EventDispatcher);e.BaseModule=t,__reflect(t.prototype,"base.BaseModule")}(base||(base={}));var base;!function(e){var t=function(){function e(){}return e}();e.BaseModuleCore=t,__reflect(t.prototype,"base.BaseModuleCore")}(base||(base={}));var loadUtil;!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(gui.OvBase);e.LoadingUI=t,__reflect(t.prototype,"loadUtil.LoadingUI")}(loadUtil||(loadUtil={}));var ModuleManager=function(){function ModuleManager(){this._moduleInfo=[]}return ModuleManager.prototype.openModule=function(p_moduleName,p_loadType,p_opendCallBack){var _this=this;void 0===p_loadType&&(p_loadType=1);for(var args=[],_i=3;_i<arguments.length;_i++)args[_i-3]=arguments[_i];var moduleInfo=this.getModuleInfo(p_moduleName);moduleInfo?this.applyModule.apply(this,[moduleInfo,p_opendCallBack].concat(args)):loadUtil.loadGroup(p_moduleName,null,function(){moduleInfo=new ModuleInfo,moduleInfo.moduleName=p_moduleName;var suffix="min.js",key="module_"+p_moduleName,jsUrl="resource/assets/module/"+p_moduleName+"/"+p_moduleName+suffix,script=document.createElement("script");script.src=jsUrl,script.onload=function(){eval("moduleInfo.mainClass= "+key+".Main"),eval("moduleInfo.coreClass= "+key+".Core"),eval("moduleInfo.dataClass= "+key+".Data"),_this._moduleInfo[p_moduleName]=moduleInfo,_this.applyModule.apply(_this,[moduleInfo,p_opendCallBack].concat(args))},document.head.appendChild(script)},this)},ModuleManager.prototype.applyModule=function(e,t){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];var s=this.getModule(e.moduleName);s?s.open.apply(s,o):(s=new e.mainClass,e.coreClass.main=s,s.moduleName=e.moduleName,this._modules[e.moduleName]=s,s.enter.apply(s,[e].concat(o)),s.addEventListener(ModuleManager.MODULE_CLOSED,this.onModuleClosed,this)),t&&t.apply()},ModuleManager.prototype.onModuleClosed=function(e){var t=e.target.moduleName;this._modules[t]=null,delete this._modules[t]},ModuleManager.prototype.getModuleInfo=function(e){return this._moduleInfo[e]},ModuleManager.prototype.getModule=function(e){return this._modules[e]},ModuleManager.MODULE_CLOSED="moduleClosed",ModuleManager.MODULE_OPENED="moduleOpened",ModuleManager}();__reflect(ModuleManager.prototype,"ModuleManager");var ModuleInfo=function(){function e(){}return e}();__reflect(ModuleInfo.prototype,"ModuleInfo");var DoorView=function(e){function t(){var t=e.call(this,"hallDoor","mainView")||this;return t._type=0,t._num=0,t._dataFlag=!1,t}return __extends(t,e),t.prototype.dispose=function(){this.remove(),e.prototype.dispose.call(this)},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var o=0;4>o;o++)2>o&&this._textList.push(this.getTextField("txt"+o));for(var n=0;n<this._buttonList.length;n++)this._buttonList[n].addEventListener(mouse.MouseEvent.ROLL_OVER,this.onRollOver,this),this._buttonList[n].addEventListener(mouse.MouseEvent.ROLL_OUT,this.onRollOut,this);api.GlobalAPI.webSocket.request(GameEvent.GetAaminiAccountInfo,{open_id:api.GlobalAPI.userData.getOpenId},this.useDataUpdate.bind(this))},t.prototype.onRollOver=function(e){var t=this._buttonList.indexOf(e.currentTarget);t>-1&&this._buttonList[t].setScale(1.1,1.1)},t.prototype.onRollOut=function(e){var t=this._buttonList.indexOf(e.currentTarget);t>-1&&this._buttonList[t].setScale(1,1)},t.prototype.initEvent=function(){this.regedEvebt={},this.regedEvebt[GameEvent.kickout]=this.kickoutF.bind(this),this.eventInit()},t.prototype.kickoutF=function(){var e=this;api.createAlert("账户在别处登陆，请重新连接",1,function(t){e.dispose(),gui.addScene(LoginView)})},t.prototype.eventInit=function(){if(null!=this.regedEvebt)for(var e in this.regedEvebt)api.GlobalAPI.webSocket.on(e,this.regedEvebt[e])},t.prototype.eventRemove=function(){if(null!=this.regedEvebt)for(var e in this.regedEvebt)api.GlobalAPI.webSocket.off(e,this.regedEvebt[e])},t.prototype.onClick=function(t){e.prototype.onClick.call(this,t);var o=this._buttonList.indexOf(t.currentTarget);o>=-1&&this._buttonList[o].setScale(1,1)},t.prototype.useDataUpdate=function(e){var t=this;0==e.errorCode?e.a&&(e.a.id&&api.GlobalAPI.userData.setUserName(e.a.id),e.a.coins&&api.GlobalAPI.userData.setUserCoins(e.a.coins)):1==e.errorCode?api.createAlert("用户不存在,返回登录界面",1,function(e){1==e&&(t.dispose(),gui.addScene(LoginView))}):2==e.errorCode&&api.createAlert("其他错误返回登录界面",1,function(e){1==e&&(t.dispose(),gui.addScene(LoginView))}),this.update()},t.prototype.update=function(){this.setText(0,api.GlobalAPI.userData.getUserName()),this.setText(1,api.GlobalAPI.userData.getUserCoins())},t.prototype.clickHandler=function(t){var o=this;switch(e.prototype.clickHandler.call(this,t),t){case 1:api.GlobalAPI.webSocket.request(GameEvent.Logout,{},function(e){"退出登陆成功"==e.msg&&o.inRoom()});break;case 6:this.clickInRoom(5);break;case 2:this.dispose(),window.open("")}},t.prototype.inRoom=function(){this.dispose(),setTimeout(function(){var e="47.52.32.227",t=9994;api.GlobalAPI.webSocket.connectServer(e+":"+t,function(){gui.addScene(LoginView)})},500)},t.prototype.addCoinsBack=function(e){e.a&&this.setText(1,e.a.coins)},t.prototype.clickInRoom=function(e){},t.prototype.inRoomBack=function(e){},t.prototype.remove=function(){this._dataFlag=!1;for(var e=0;e<this._buttonList.length;e++)this._buttonList[e].removeEventListener(mouse.MouseEvent.ROLL_OVER,this.onRollOver,this),this._buttonList[e].removeEventListener(mouse.MouseEvent.ROLL_OUT,this.onRollOut,this)},t}(gui.OvBase);__reflect(DoorView.prototype,"DoorView");var GameEvent=function(){function e(){}return e.Login="miniGame.Login",e.AaAccountVerify="miniGame.AaAccountVerify",e.CreateAaminiAccount="miniGame.CreateAaminiAccount",e.GetAaminiAccountInfo="miniGame.GetAaminiAccountInfo",e.kickout="kickout",e.Logout="miniGame.Logout",e}();__reflect(GameEvent.prototype,"GameEvent");var LoginView=function(e){function t(){return e.call(this,"common","loginView")||this}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.login=this._ui.getController("login"),this.login.setSelectedIndex(0);for(var o=0;5>o;o++)this._textList.push(this.getTextField("txt"+o))},t.prototype.clickHandler=function(t){switch(e.prototype.clickHandler.call(this,t),t){case 1:this.gotoLogin();break;case 2:this.setText(3,""),this.setText(4,""),this.setText(2,""),this.login.setSelectedIndex(1);break;case 3:this.createUserName();break;case 4:case 5:this.setText(0,""),this.setText(1,""),this.login.setSelectedIndex(0)}},t.prototype.gotoLogin=function(){return""==this.getText(0)||""==this.getText(1)?void api.createAlert("账号或密码不能为空"):void api.GlobalAPI.webSocket.request(GameEvent.AaAccountVerify,{userName:this.getText(0),pwd:this.getText(1)},this.callbackByAaA.bind(this),function(e,t,o){console.error("无法连接游戏服务器.请确认网络连接无异常.[code:%s, msg:%s]",t,o)})},t.prototype.callbackByAaA=function(e){0==e.errorCode?(this.dispose(),api.GlobalAPI.userData.setOpenId(e.open_id),api.GlobalAPI.webSocket.login(e.open_id)):1==e.errorCode?api.createAlert("用户不存在"):2==e.errorCode?api.createAlert("/密码错误"):3==e.errorCode&&api.createAlert("其他错误登录失败")},t.prototype.createUserName=function(){api.GlobalAPI.webSocket.request(GameEvent.CreateAaminiAccount,{userName:this.getText(3),pwd:this.getText(4),email:this.getText(2)},this.userNameBack.bind(this),function(e,t,o){console.error("无法连接游戏服务器.请确认网络连接无异常.[code:%s, msg:%s]",t,o)})},t.prototype.userNameBack=function(e){0==e.errorCode?e.open_id&&(api.GlobalAPI.userData.setOpenId(e.open_id),this.setText(0,this.getText(3)),this.setText(1,this.getText(4)),this.gotoLogin()):1==e.errorCode?api.createAlert("用户已经存在"):2==e.errorCode?api.createAlert("用户名太长"):3==e.errorCode?api.createAlert("用户名太短"):4==e.errorCode?api.createAlert("密码太短太短"):5==e.errorCode?api.createAlert("密码太长"):6==e.errorCode?api.createAlert("账号密码只能是字母或数字"):7==e.errorCode&&api.createAlert("其他错误")},t}(gui.OvBase);__reflect(LoginView.prototype,"LoginView");